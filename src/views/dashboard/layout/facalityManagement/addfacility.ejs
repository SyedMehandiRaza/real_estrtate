<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Add Facility Company</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />

    <style>
      /* SAME CSS YOU ALREADY HAVE (UNCHANGED) */
      :root {
        --bg-main: #f7f6fb;
        --bg-card: #ffffff;
        --border-soft: #e4e2ee;
        --border-input: #e2e2ea;
        --text-main: #2b2b35;
        --text-muted: #a0a0b2;
        --primary: #7b3cff;
        --primary-soft: #f2ecff;
        --danger: #ff4a4a;
        --radius-card: 20px;
        --radius-input: 10px;
        --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.06);
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
      }
      body {
        background: var(--bg-main);
        color: var(--text-main);
      }
      .main-container {
        margin-left: 260px;
        padding: 24px 32px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        width: 100%;
        min-width: 1300px;
      }
      .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .header-title {
        font-size: 18px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .info-card {
        background: var(--bg-card);
        border-radius: var(--radius-card);
        padding: 20px 22px 20px;
        box-shadow: var(--shadow-soft);
        flex: 1;
      }
      .card-title {
        font-size: 16px;
        font-weight: 500;
      }
      .form-layout {
        display: grid;
        grid-template-columns: 1.2fr 1.1fr;
        column-gap: 30px;
        row-gap: 18px;
      }
      .input-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .input-label {
        font-size: 11px;
        color: var(--text-muted);
      }
      .mandatory-dot {
        color: var(--danger);
      }
      .text-input,
      .dropdown,
      .text-area {
        border-radius: var(--radius-input);
        border: 1px solid var(--border-input);
        padding: 10px 14px;
        font-size: 11px;
      }
      .text-area {
        min-height: 98px;
        resize: none;
      }
      .button {
        border-radius: 10px;
        padding: 10px 30px;
        font-size: 13px;
        cursor: pointer;
      }
      .button-primary {
        background: var(--primary);
        color: #fff;
        border: none;
      }
      .button-outline {
        background: #fff;
        border: 1px solid var(--border-soft);
      }
    </style>
  </head>

  <body>
    <div class="main-container">
      <div class="header-bar">
        <div class="header-title">
          <span>Add Facility Company</span>
        </div>
      </div>

      <div class="info-card">
        <div class="card-title">Company Detail</div>

        <form
          class="form-layout"
          method="POST"
          action="/addfacility"
          enctype="multipart/form-data"
        >
          <div class="input-group">
            <label class="input-label"
              >Company Name<span class="mandatory-dot">*</span></label
            >
            <input class="text-input" type="text" name="companyName" required />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Contact Person<span class="mandatory-dot">*</span></label
            >
            <input
              class="text-input"
              type="text"
              name="contactPerson"
              required
            />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Email<span class="mandatory-dot">*</span></label
            >
            <input
              class="text-input"
              type="email"
              name="companyEmail"
              required
            />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Phone Number<span class="mandatory-dot">*</span></label
            >
            <input class="text-input" type="text" name="phoneNumber" required />
          </div>

          <div class="input-group">
            <label class="input-label">Address</label>
            <input class="text-input" type="text" name="companyAddress" />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Assigned Properties<span class="mandatory-dot">*</span></label
            >
            <% if (properties && properties.length > 0) { %>
            <select
              id="assignedProperties"
              name="propertyIds[]"
              multiple
              style="width: 100%"
            >
              <% properties.forEach(function(property){ %>
              <option value="<%= property.id %>"><%= property.title %></option>
              <% }) %>
            </select>
            <% } else { %>
            <select disabled>
              <option>No property to assign</option>
            </select>
            <% } %>
          </div>

          <div class="input-group">
            <label class="input-label"
              >Contract Start Date<span class="mandatory-dot">*</span></label
            >
            <input class="text-input" type="date" name="startDate" required />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Contract End Date<span class="mandatory-dot">*</span></label
            >
            <input class="text-input" type="date" name="endDate" required />
          </div>

          <div class="input-group">
            <label class="input-label"> Upload Document </label>

            <div
              id="dropZone"
              style="
                border: 1px dashed #e2e2ea;
                border-radius: 10px;
                padding: 18px;
                font-size: 11px;
                color: #a0a0b2;
                cursor: pointer;
                background: #fffbec;
                text-align: center;
              "
            >
              <input
                type="file"
                id="documentInput"
                name="document"
                style="display: none"
                accept=".pdf,.doc,.docx,.jpg,.png"
              />
              <span id="dropText">Click or drag document here</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Notes / Scope of Work</label>
            <textarea class="text-area" name="notes"></textarea>
          </div>

          <button type="submit" class="button button-primary">Save</button>
          <button
            type="button"
            class="button button-outline"
            onclick="window.history.back()"
          >
            Back
          </button>
        </form>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#assignedProperties").select2({
          placeholder: "Select properties",
          allowClear: true,
        });
      });
    </script>
    <script>
      const dropZone = document.getElementById("dropZone");
      const fileInput = document.getElementById("documentInput");
      const dropText = document.getElementById("dropText");

      dropZone.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", () => {
        if (fileInput.files.length > 0) {
          dropText.innerText = "Selected: " + fileInput.files[0].name;
        }
      });

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.style.background = "#fff4d6";
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.style.background = "#fffbec";
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.style.background = "#fffbec";

        const files = e.dataTransfer.files;
        if (files.length > 0) {
          fileInput.files = files;
          dropText.innerText = "Selected: " + files[0].name;
        }
      });
    </script>
  </body>
</html>

<!-- <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Add Facility Company</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/facilityManagement/add_company.css">
  </head>
  <body>
    <div class="main-container">
      <div class="header-bar">
        <div class="header-title">
          <span class="back-chevron">&#x2039;</span>
          <span>Add Facility Company</span>
        </div>
        <div class="header-actions">
          <div class="notif-icon">
            <div class="notif-dot"></div>
            <span style="font-size: 16px; color: #b8b8c7">&#128276;</span>
          </div>
          <div class="user-avatar"></div>
        </div>
      </div>

      <div class="info-card">
        <div class="card-title">Company Detail</div>

        <form
          class="form-layout"
          method="POST"
          action="/addfacility"
          id="facilityForm"
          enctype="multipart/form-data"
        >
          <div class="input-group">
            <label class="input-label"
              >Company Name<span class="mandatory-dot">*</span></label
            >
            <input
              class="text-input"
              type="text"
              name="companyName"
              placeholder="Enter Property Name"
            />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Contact Person<span class="mandatory-dot">*</span></label
            >
            <input
              class="text-input"
              type="text"
              name="contactPerson"
              placeholder="Enter"
            />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Email<span class="mandatory-dot">*</span></label
            >
            <input
              class="text-input"
              name="companyEmail"
              type="email"
              placeholder="Enter"
            />
          </div>

          <div class="input-group">
            <label class="input-label"
              >Phone Number<span class="mandatory-dot">*</span></label
            >
            <input
              class="text-input"
              name="phoneNumber"
              type="text"
              placeholder="Enter"
            />
          </div>

          <div class="input-group">
            <label class="input-label">Address</label>
            <input
              class="text-input"
              name="companyAddress"
              type="text"
              placeholder="Enter"
            />
          </div>

        

          <div class="input-group">
            <label class="input-label">
              Assigned Properties<span class="mandatory-dot">*</span>
            </label>

            <% if (properties && properties.length > 0) { %>
            <select id="assignedProperties" style="width: 100%" multiple>
              <% properties.forEach(function(property) { %>
              <option value="<%= property.id %>"><%= property.title %></option>
              <% }); %>
            </select>
            <% } else { %>
            <select class="dropdown" disabled style="width: 100%">
              <option value="">No property to assign</option>
            </select>
            <% } %>
          </div>

          <div class="input-group date-group">
            <label class="input-label">
              Contract Start Date<span class="mandatory-dot">*</span>
            </label>
            <input class="text-input" name="startDate" type="date" />
          </div>

          <div class="input-group date-group">
            <label class="input-label">
              Contract End Date<span class="mandatory-dot">*</span>
            </label>
            <input class="text-input" name="endDate" type="date" />
          </div>

         

          <div class="input-group">
            <label class="input-label">Notes / Scope of Work</label>
            <textarea
              class="text-area"
              name="notes"
              placeholder="Describe"
            ></textarea>
          </div>
          <button
            class="button button-outline"
            onclick="window.location.href='index.html'"
          >
            Back
          </button>
          <button class="button button-primary" type="submit">Save</button>
        </form>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#assignedProperties").select2({
          placeholder: "Select properties",
          allowClear: true,
        });
      });
    </script>
    <script>
  const dropZone = document.getElementById("dropZone");
  const fileInput = document.getElementById("documentInput");
  const dropText = document.getElementById("dropText");

  // click opens file picker
  dropZone.addEventListener("click", () => {
    fileInput.click();
  });

  // when file selected
  fileInput.addEventListener("change", () => {
    if (fileInput.files.length > 0) {
      dropText.innerText = "Selected: " + fileInput.files[0].name;
    }
  });

  // drag over
  dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.style.background = "#fff4d6";
  });

  // drag leave
  dropZone.addEventListener("dragleave", () => {
    dropZone.style.background = "#fffbec";
  });

  // drop file
  dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.style.background = "#fffbec";

    const files = e.dataTransfer.files;
    if (files.length > 0) {
      fileInput.files = files; // assign file
      dropText.innerText = "Selected: " + files[0].name;
    }
  });
</script>
<script>
  $("#facilityForm").on("submit", function (e) {
    e.preventDefault();

    const selectedProperties = $("#assignedProperties").val();
    const startDate = $("input[name='startDate']").val();
    const endDate = $("input[name='endDate']").val();
    const notes = $("textarea[name='notes']").val();

    if (!selectedProperties || selectedProperties.length === 0) {
      alert("Select at least one property");
      return;
    }

    const properties = [];
    selectedProperties.forEach(pid => {
      properties.push({
        propertyId: pid,
        startDate: startDate,
        endDate: endDate,
        notes: notes
      });
    });

    const formData = new FormData(this);

    // add properties as JSON string
    formData.append("properties", JSON.stringify(properties));

    fetch("/addfacility", {
      method: "POST",
      body: formData   
    })
    .then(res => res.text())
    .then(data => {
      console.log(data)
      if (data.success) {
        console.log(data)
        alert("Company added successfully");
        window.location.href = "/facility";
      } else {
        alert(data.error || "Something went wrong");
      }
    })
    .catch(err => {
      console.error(err);
      alert("Server error");
    });
  });
</script>


  </body>
</html> -->
